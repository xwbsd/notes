## XSS

**XSS (跨站脚本攻击)**是指攻击者利用网站漏洞将代码注入到其他用户浏览器的攻击方。例如窃取 Cookie 信息；监听用户行为；修改 DOM 伪造登录，浮窗广告等。

### 反射型

用户将一段含有恶意代码的请求提交给服务器，服务器接收后又将恶意代码反射给浏览器

例如 `xxx.com?name=<script src="http://a.com/attack.js" />` 的请求在服务端未经处理直接把 name 字段拼接至前端模板并返回给用户

- 利用 URL 进行伪装
- 服务器不会存储恶意代码
- 在用户不知情的情况下执行了攻击者注入的脚本

### 存储型

利用站点漏洞将恶意代码提交到网站数据库，当其他用户浏览器请求数据时，注入脚本从服务器返回并执行

例如攻击者在留言板提交了 `<script src="http://a.com/attack.js" />` 而服务端未经转义存储了恶意代码，并将其渲染到页面中，再次访问该留言板市，会自动执行攻击者注入脚本

- 恶意代码存储在目标网站服务器上
- 只要用户访问被注入恶意脚本的页面，就会被攻击

### DOM 型

不涉及服务器，WEB 资源传输或用户使用过程中被修改页面的数据

例如 WiFi 路由拦截等

- 在客户端发生

### 防范 XSS

1. 对于外部传入的内容进行过滤或转码
   - script, alert, <, > 等
2. 开启 CSP (Content Security Policy, 内容安全策略)
   - 限制加载其他域下的资源文件
   - 禁止向第三方域提交数据
   - 禁止执行内联脚本和未授权的脚本
   - 提供上报机制，帮助尽快发现 XSS 攻击，修复问题
3. 设置 Cookie HttpOnly 属性，禁止 JavaScript 读取 document.cookie
4. 添加验证码，限制输入长度等

## CSRF

**CSRF (跨站请求伪造)**诱导用户进入第三方网站，在第三方网站中向被攻击网站发送跨站请求，利用用户的登录状态冒充用户对被攻击的网站执行某项操作

例如：

1. 利用 img src 伪装请求 `<img src="http://xxx.com/article/delete" />`，自动发起 get 请求
2. 利用 form.submit()，自动发起 post 请求
3. 利用超链接 a，引诱用户点击链接

- 目标站点有 CSRF 漏洞
- 用户登录过目标站点，并在浏览器保持该站点的登录状态
- 用户打开了第三方站点

### 防范 CSRF

1. CSRF Token 验证身份
   - 服务端生成 CSRF Token (例如 session)，用户提交请求时徐携带 Token，服务端验证 Token 是否有效
2. Cookie 的 SameSite 属性，限制第三方 Cookie
   - SameSite 属性仅 HTTPS 设置有效
   - Strict: 完全禁止第三方 Cookie
   - Lax: 只允许链接、预加载请求和 get 表单发送第三方 Cookie
   - None: 关闭 SameSite 属性
3. 双重 Cookie 验证
   - 利用攻击者无法获取 Cookie 在请求头或 URL 参数中携带 Cookie 数据，服务端再验证 Cookie 是否一致
4. 白名单模式，仅允许安全域名请求
5. 验证码校验

## MITM

**MITM (中间人攻击)**是一种通过各种技术手段入侵两台设备通信的网络攻击方式

### 拦截

攻击者再用户数据到达目标设备前拦截并通过攻击者的网络

- 被动攻击：恶意的 WiFi 热点，一旦有受害者连接了该热点，攻击者就能完全了解其所有的在线数据交换
- 主动攻击：
  1. ARP 欺骗：通过冒充网关或其他主机，使得到达网关或其他主机通过攻击者主机进行转发
  2. DNS 欺骗：通过冒充域名服务器，将受害者查询的 IP 地址转发到攻击者的 IP 地址

### 解密

若链接使用 HTTPS 协议对传输的数据用了 SSL/TLS 加密，这时需要解密用户数据

1. SSL 劫持（伪造证书）
   - 攻击者拦截到服务器返回的公钥后，将其替换成自己的公钥返回给客户端（攻击者可以用自己的私钥去解密用户数据，用服务的公钥解密服务器数据）
   - 因为是伪造的证书，客户端再校验证书过程中会提示证书错误
   - 若用户任选择继续操作，此时中间人便能获取与服务端的通信数据
2. SSL 剥离
   - 攻击者拦截后继续和服务器保持 HTTPS 链接，并与用户降级为不安全的 HTTP 连接
   - 服务端可以通过开启 HSTS (HTTP Strict Transport Security) 策略告知浏览器必须使用 HTTPS 链接，但是用户的首次访问仍不受保护

### 防范 MITM

- 开发者
  - 支持 HTTPS
  - 开启 HSTS 策略
- 对于用户
  - 尽可能使用 HTTPS 链接
  - 避免连接不知名的 WiFi 热点
  - 不忽略不安全的浏览器通知
  - 公共网络不进行涉及敏感信息的交互
  - 用可信的第三方 CA 厂商，不下载来源不明的证书

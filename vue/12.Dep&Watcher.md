## Dep

defineReactive 的开始执行 `const dep = new Dep()` 实例化一个 Dep 实例，之后在 Object.defineProperty 的 get 函数中通过 `dep.depend()` 进行依赖收集。Dep 是整个 getter 依赖收集的核心。

> src/core/observer/dep.js

```javascript
import type Watcher from './watcher'
import { remove } from '../util/index''

let uid = 0

// a dep is an observable that can have multiple directives subscribing to it
/**
* Dep 是对 Watcher 的一种管理，Dep 脱离 Watcher 单独存在毫无意义
*/
export default class Dep {
  static target: ?Watcher
  id: number
  subs: Watcher[]

  constructor () {
    this.id = uid++
    this.subs = []
  }

  addSub(sub: Watcher) {
    this.subs.push(sub)
  }
  removeSub(sub: Watcher) {
    remove(this.subs, sub)
  }
  depend() {
    if (Dep.target) {
      Dep.target.addDep(this)
    }
  }
  notify() {
    // stabilize the subscriber list first
    const subs = this.subs.slice()
    for(let i = 0, l = subs.length; i < l; i++) {
      subs[i].update()
    }
  }
}

// the current targe watcher being evaluated. this is globally unique because there could be only one watcher being evaluated at any time.
/**
* 这是一个全局唯一 Watcher
* 因为在同一时间只能有一个全局的 Watcher 被计算
*/
Dep.target = null
const targetStack = []

export function pushTarget (_target?: Watcher) {
  if (Dep.target) targetStack.push(Dep.target)
  Dep.target = _target
}

export function popTarget() {
  Dep.target = targetStack.pop()
}
```

当模板 template 经过 parse 生成输出 AST 树，接下来需要对树进行 optimize 优化。
Vue 是数据驱动的，响应式的，但是模板中并非所有数据都是响应式的，很多数据首次渲染后就永远不会改变，那么这部分数据生成的 DOM 也不会再改变，可以在 patch 的过程跳过它们的比对。

> src/compiler/optimizer.js

```javascript
// goal of the optimizer: walk the generated template AST tree and detect sub-trees that are purely static, i.e. parts of the DOM that never needs to change.
// once we detect these sub-trees, we can:
// 1. hoist them into constants, so that we no longer need to create fresh nodes for them on each re-render.
// 2. completely skip them in the patching process.
export function optimize(
  root, // ?ASTElement
  options // compilerOptions
) {
  if (!root) return;
  isStaticKey = genStaticKeysCached(options.staticKeys || "");
  isPlatformReservedTag = options.isReservedTag || no;
  // first pass: mark all non-static nodes
  /**
   * 标记静态节点
   */
  markStatic(root);
  // second pass: mark static roots
  /**
   * 标记静态根
   */
  markStaticRoots(root, false);
}

function genStaticKeys(keys /* string */) {
  return makeMap(
    "type,tag,attrsList,attrsMap,plain,parent,children,attrs" +
      (keys ? "," + keys : "")
  );
}
```

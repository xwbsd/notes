## 规范化

初始化 props 之前，会在 mergeOptions 时对 props 做一次 normalize：

```javascript
// src/core/util/options.js
export function mergeOptions(
  parent, // Object
  child, // Object
  vm // ? Component
) {
  // ...
  normalizeProps(child, vm);
  // ...
}
/**
 * 把编写的 props 转成带有 type 的对象格式
 */
function normalizeProps(options /* object */, vm /* ? Component */) {
  const props = options.props;
  if (!props) return;
  const res = {};
  let i, val, name;
  if (Array.isArray(props)) {
    /**
     * 当 props 是数组，每一个数组元素 prop 只能是 string
     * 表示 prop 的 key 转成驼峰格式，类型为 null
     */
    i = props.length;
    while (i--) {
      val = props[i];
      if (typeof val === "string") {
        name = camelize(val);
        res[name] = { type: null };
      } else if (process.env.NODE_ENV !== "production") {
        // warn('props must be strings when using arrat syntax')
      }
    }
  } else if (isPlainObject(props)) {
    /**
     * 当 props 是一个对象
     * 对于 props 每个 prop 的 key 转成驼峰，value 规范成一个对象
     */
    for (const key in props) {
      val = props[key];
      name = camelize(key);
      res[name] = isPlainObject(val) ? val : { type: val };
    }
  } else if (process.env.NODE_ENV !== "prodution") {
    // warn(`props expected an Array or an Object`)
  }
  options.props = res;
}
```

## 初始化

```javascript
export function initState(vm /* Component */) {
  // ...
  const opts = vm.$options;
  if (opts.props) initProps(vm, opts.props);
  // ...
}

function initProps(vm /* Component */, propsOptions /* object */) {
  const propsData = vm.$options.propsData || {};
  const props = (vm._props = {});
  // cache prop keys so that future props updates can iterate using Array instead of dynamic object key enumeration
  const keys = (vm.$options._propKeys = []);
  const isRoot = !vm.$parent;
  // root instance props should be converted
  if (!isRoot) {
    toggleObserving(false);
  }
  for (const key in propsOptions) {
    keys.push(key);
    const value = validateProp(key, propsOptions, propsData, vm);
    if (process.env.NODE_ENV !== "production") {
      const hyphenatedKey = hyphenate(key);
      if (
        isReservedAttribute(hyphenatedKey) ||
        config.isReservedAttr(hyphenatedKey)
      ) {
        // warn(${hyphenatedKey} is a reserved attribute and cannot be used as component prop)
      }
      defineReactive(props, key, value, () => {
        if (!isRoot && !isUpdatingChildComponent) {
          // warn(avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders, instead, use a data or computed property based on the prop's value)
        }
      });
    } else {
      defineReactive(props, key, value);
    }
    // static props are already proxied on the component's prototype during Vue.extend()
    if (!(key in vm)) {
      proxy(vm, `_props`, key);
    }
  }
  toggleObserving(true);
}
```

### 校验 validateProp

```javascript
export function validateProp(
  key, // string
  propsOptions, // object
  propsData, // object
  vm // ? Component
) {
  const prop = propsOptions[key];
  const absent = !hasOwn(propsData, key);
  let value = propsData[key];
  // boolean casting
  /**
   * 处理 boolean 类型的数据
   */
  const booleanIndex = getTypeIndex(Boolean, prop.type);
  if (booleanIndex > -1) {
    if (absent && !hasOwn(prop, "default")) {
      value = false;
    } else if (value === "" || value === hyphenate(key)) {
      // only cast empty string/same name to boolean if boolean has higher priority
      const stringIndex = getTypeIndex(String, prop.key);
      if (stringIndex < 0 || booleanIndex < stringIndex) {
        value = true;
      }
    }
  }
  // check default value
  /**
   * 处理默认数据
   */
  if (value === undefined) {
    value = getPropDefaultValue(vm, prop, key);
    // since the default value is a fresh copy, make sure to observe it
    const prevShouldObserve = shouldObserve;
    toggleObserving(true);
    observe(value);
    toggleObserving(prevShouldObserve);
  }
  /**
   * 在开发环境且非 weex 的环境下，执行 assertProp 做属性断言
   */
  if (
    process.env.NODE_ENV !== "production" &&
    // skip validation for weex recycle-list child component props
    !(__WEEX__ && isObject(value) && "@binding" in value)
  ) {
    assertProp(prop, key, value, vm, absent);
  }
  return value;
}
```

1. 通过 getTypeIndex 判断 prop 定义是否是 boolean 类型

```javascript
```